<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MRL4THEW | Universal Shhhh-O-Meter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Prevent bounce scrolling on mobile */
        body { 
            background-color: #050505; 
            overscroll-behavior: none;
            touch-action: manipulation;
        }
        .lcd-text { font-family: 'Courier New', Courier, monospace; }
        
        /* Custom Range Slider Styling */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%;
            background: #10b981; margin-top: -10px; box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #27272a; border-radius: 2px;
        }
        
        .cooldown-active { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0% { border-color: #ef4444; box-shadow: 0 0 20px #ef4444; }
            50% { border-color: #450a0a; box-shadow: 0 0 0px #000; }
            100% { border-color: #ef4444; box-shadow: 0 0 20px #ef4444; }
        }
        canvas { border-radius: 0.75rem; }

        /* POPUP ANIMATION */
        #shush-overlay {
            opacity: 0; pointer-events: none; transform: scale(0.8); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #shush-overlay.active {
            opacity: 1; transform: scale(1);
        }
        
        /* HAND ANIMATION */
        .shush-hand { animation: shush-motion 0.5s infinite alternate ease-in-out; transform-origin: center bottom; }
        @keyframes shush-motion {
            0% { transform: translateY(0); }
            100% { transform: translateY(-3px); }
        }
    </style>
</head>
<body class="text-emerald-500 h-dvh w-screen overflow-hidden flex flex-col p-2 md:p-6 select-none relative">

    <div class="absolute top-0 left-0 p-1 bg-zinc-800 text-[9px] text-zinc-400 font-mono z-50 rounded-br-lg opacity-50">
        v1.3
    </div>

    <div id="shush-overlay" class="absolute inset-0 z-40 flex items-center justify-center bg-black/90 backdrop-blur-md">
        <div class="flex flex-col items-center">
            
            <svg width="240" height="240" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-2xl">
                <circle cx="100" cy="100" r="90" fill="#FACC15"/> 
                <circle cx="100" cy="100" r="90" stroke="#EAB308" stroke-width="4"/> 
                
                <ellipse cx="65" cy="80" rx="10" ry="14" fill="#4B5563"/>
                <ellipse cx="135" cy="80" rx="10" ry="14" fill="#4B5563"/>
                
                <path d="M55 65 Q65 60 75 65" stroke="#92400E" stroke-width="5" stroke-linecap="round"/>
                <path d="M125 65 Q135 60 145 65" stroke="#92400E" stroke-width="5" stroke-linecap="round"/>

                <g class="shush-hand">
                    <rect x="75" y="130" width="18" height="40" rx="8" fill="#FACC15" stroke="#CA8A04" stroke-width="3"/>
                    <rect x="94" y="132" width="18" height="38" rx="8" fill="#FACC15" stroke="#CA8A04" stroke-width="3"/>
                    <rect x="113" y="135" width="18" height="35" rx="8" fill="#FACC15" stroke="#CA8A04" stroke-width="3"/>
                    
                    <rect x="85" y="90" width="22" height="70" rx="10" fill="#FACC15" stroke="#CA8A04" stroke-width="3"/>
                    
                    <path d="M80 150 Q100 160 120 145" stroke="#CA8A04" stroke-width="3" fill="#FACC15" stroke-linecap="round"/>
                </g>
            </svg>

            <h1 class="text-5xl md:text-7xl font-black text-white mt-4 tracking-tighter uppercase drop-shadow-lg">SHHHHH!</h1>
            <p class="text-red-500 font-bold uppercase tracking-widest mt-2 animate-pulse">Too Loud</p>
        </div>
    </div>

    <div id="main-frame" class="flex flex-col w-full h-full max-w-7xl mx-auto bg-zinc-900 border border-zinc-800 rounded-2xl md:rounded-[2rem] shadow-2xl relative transition-all duration-300">
        
        <div class="flex flex-shrink-0 justify-between items-center p-3 md:p-6 bg-black rounded-t-2xl md:rounded-t-[2rem] border-b border-zinc-800">
            <div>
                <h1 class="text-xl md:text-4xl font-black tracking-tighter text-white uppercase italic leading-none">MRL4THEW</h1>
                <p class="text-emerald-500 font-bold text-[10px] md:text-xs mt-1 uppercase tracking-widest italic">The "Be Quiet Game"</p>
            </div>
            <div class="text-right">
                <p id="cooldown-status" class="text-[9px] md:text-[10px] text-zinc-500 uppercase font-bold tracking-widest">Acoustic Monitor</p>
                <div class="flex items-center gap-2 justify-end">
                    <div id="status-dot" class="w-2 h-2 rounded-full bg-zinc-600"></div>
                    <h2 class="text-lg md:text-3xl font-black text-emerald-500 lcd-text uppercase">Shhhh-o-meter</h2>
                </div>
            </div>
        </div>

        <div class="flex-1 min-h-0 grid grid-cols-1 md:grid-cols-12 gap-2 md:gap-6 p-2 md:p-6 overflow-y-auto md:overflow-hidden">
            
            <div class="col-span-1 md:col-span-3 flex flex-row md:flex-col gap-2 md:gap-4 order-2 md:order-1">
                <div class="flex-1 bg-black rounded-xl border border-zinc-800 p-3 md:p-5 flex flex-col justify-center shadow-inner">
                    <div class="flex justify-between mb-2">
                        <span class="text-[10px] uppercase font-bold text-zinc-500">Mic Gain</span>
                        <span id="gain-val" class="text-[10px] font-bold text-emerald-500">1.5x</span>
                    </div>
                    <input type="range" id="gain" min="0.1" max="5.0" step="0.1" value="1.5" class="w-full accent-emerald-500">
                </div>
                <div class="flex-1 bg-black rounded-xl border border-zinc-800 p-3 md:p-5 flex flex-col justify-center shadow-inner">
                    <div class="flex justify-between mb-2">
                        <span class="text-[10px] uppercase font-bold text-zinc-500">Sponge</span>
                        <span id="sponge-val" class="text-[10px] font-bold text-blue-500">1.0x</span>
                    </div>
                    <input type="range" id="spongeSpeed" min="0.1" max="2.5" step="0.1" value="1.0" class="w-full accent-blue-500">
                </div>
            </div>

            <div class="col-span-1 md:col-span-6 order-1 md:order-2 bg-black rounded-xl border border-zinc-800 relative p-1 overflow-hidden shadow-inner flex flex-col min-h-[180px]">
                <canvas id="spectrumCanvas" class="w-full h-full object-cover"></canvas>
                <div id="threshold-line" class="absolute left-0 w-full border-t-2 md:border-t-4 border-dotted border-red-600/80 z-20 pointer-events-none" style="top: 50%;"></div>
            </div>

            <div class="col-span-1 md:col-span-3 flex flex-row md:flex-col gap-2 md:gap-4 order-3 md:order-3">
                <div class="flex-1 bg-black rounded-xl border border-zinc-800 p-2 md:p-4 flex flex-col items-center justify-center relative overflow-hidden shadow-inner min-h-[100px]">
                    <span class="text-[10px] text-zinc-500 font-bold mb-1 uppercase tracking-widest">Strikes</span>
                    <div id="tally" class="text-6xl md:text-8xl lg:text-9xl font-black text-white italic z-10 tabular-nums leading-none">0</div>
                </div>
                
                <div class="flex-1 bg-black rounded-xl border border-zinc-800 relative overflow-hidden shadow-inner min-h-[60px]">
                    <div id="sponge-fill" class="absolute bottom-0 w-full bg-emerald-600 transition-all" style="height: 0%; transition-duration: 80ms;"></div>
                    <div class="absolute inset-0 flex items-center justify-center text-[10px] md:text-xs font-black text-white mix-blend-difference uppercase tracking-widest">Saturate</div>
                </div>
            </div>
        </div>

        <div class="flex flex-shrink-0 gap-2 md:gap-4 p-3 md:p-6 bg-zinc-900 rounded-b-2xl md:rounded-b-[2rem]">
            <button id="snapBtn" class="bg-zinc-200 hover:bg-white text-black font-black rounded-lg md:rounded-xl uppercase text-[10px] md:text-xs transition-all active:scale-95 shadow-lg px-2 md:px-6 py-3 md:py-4 flex-1 truncate">
                Snapshot
            </button>

            <div class="bg-black px-4 rounded-lg md:rounded-xl border border-zinc-800 flex flex-col justify-center shadow-inner flex-[2]">
                <div class="flex justify-between text-[9px] font-bold mb-1 uppercase tracking-tighter">
                    <span class="text-zinc-500">Limit</span>
                    <span id="threshold-val" class="text-emerald-500">50</span>
                </div>
                <input type="range" id="threshold" min="5" max="95" value="50" class="w-full accent-emerald-500 cursor-pointer">
            </div>
            
            <button id="startBtn" class="bg-emerald-600 hover:bg-emerald-500 text-black font-black rounded-lg md:rounded-xl uppercase text-[10px] md:text-xs transition-all active:scale-95 shadow-lg flex-1 truncate">
                START
            </button>
            
            <button id="resetBtn" class="bg-zinc-800 hover:bg-zinc-700 text-zinc-400 font-bold rounded-lg md:rounded-xl uppercase text-[10px] md:text-xs tracking-widest px-3 md:px-4 active:scale-95">
                RST
            </button>
        </div>
    </div>

    <script>
        let audioCtx, analyser, dataArray, canvas, canvasCtx;
        let sponge = 0, tallyCount = 0, currentVolPct = 0, cooldownActive = false;
        let animationId;

        const startBtn = document.getElementById('startBtn'), snapBtn = document.getElementById('snapBtn');
        const spongeFill = document.getElementById('sponge-fill'), tallyDisplay = document.getElementById('tally');
        const frame = document.getElementById('main-frame'), cooldownStatus = document.getElementById('cooldown-status');
        const gainIn = document.getElementById('gain'), spongeIn = document.getElementById('spongeSpeed');
        const thresholdIn = document.getElementById('threshold'), thresholdLine = document.getElementById('threshold-line');
        const statusDot = document.getElementById('status-dot');
        const shushOverlay = document.getElementById('shush-overlay');

        // UI Value Updaters
        gainIn.addEventListener('input', () => document.getElementById('gain-val').innerText = gainIn.value + 'x');
        spongeIn.addEventListener('input', () => document.getElementById('sponge-val').innerText = spongeIn.value + 'x');
        thresholdIn.addEventListener('input', () => {
             document.getElementById('threshold-val').innerText = thresholdIn.value;
             thresholdLine.style.top = (100 - thresholdIn.value) + '%';
        });

        // Responsive Canvas
        canvas = document.getElementById('spectrumCanvas');
        canvasCtx = canvas.getContext('2d');
        
        function resize() { 
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth; 
            canvas.height = parent.clientHeight; 
        }
        window.addEventListener('resize', resize);
        setTimeout(resize, 100);

        async function init() {
            try {
                if (audioCtx && audioCtx.state === 'suspended') {
                    await audioCtx.resume();
                }
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const source = audioCtx.createMediaStreamSource(stream);
                    analyser = audioCtx.createAnalyser(); 
                    analyser.fftSize = 64;
                    analyser.smoothingTimeConstant = 0.85; 
                    source.connect(analyser);
                    dataArray = new Uint8Array(analyser.frequencyBinCount);
                }
                
                startBtn.innerText = "LIVE"; 
                startBtn.disabled = true;
                startBtn.classList.replace('bg-emerald-600', 'bg-zinc-800');
                startBtn.classList.replace('text-black', 'text-emerald-500');
                statusDot.classList.replace('bg-zinc-600', 'bg-red-500');
                statusDot.classList.add('animate-pulse');
                
                resize();
                draw();
            } catch(e) { 
                alert("Microphone access denied."); 
            }
        }

        function draw() {
            animationId = requestAnimationFrame(draw);
            if(!analyser) return;
            analyser.getByteFrequencyData(dataArray);
            
            const gain = parseFloat(gainIn.value);
            const threshold = parseInt(thresholdIn.value);
            const spongeFactor = parseFloat(spongeIn.value);

            canvasCtx.fillStyle = '#000'; canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
            let barWidth = (canvas.width / dataArray.length);
            let speechVolume = 0;
            
            for (let i = 0; i < dataArray.length; i++) {
                let val = (i < 2) ? dataArray[i] * 0.2 : dataArray[i];
                let barHeight = (val * gain / 255) * canvas.height;
                
                speechVolume += barHeight;
                canvasCtx.fillStyle = `hsl(${140 + (i*4)}, 80%, 50%)`;
                canvasCtx.fillRect(i * barWidth, canvas.height - barHeight, barWidth - 1, barHeight);
            }

            let avgHeight = speechVolume / dataArray.length;
            currentVolPct = Math.min((avgHeight / canvas.height) * 250, 100);

            if (!cooldownActive) {
                if (currentVolPct > threshold) {
                    sponge += (currentVolPct - threshold) * (spongeFactor * 0.15);
                } else {
                    sponge -= (0.4 / spongeFactor);
                }
            }

            sponge = Math.max(0, Math.min(100, sponge));
            spongeFill.style.height = sponge + '%';

            if (sponge > 80 && !cooldownActive) spongeFill.style.backgroundColor = '#facc15';
            else if (!cooldownActive) spongeFill.style.backgroundColor = '#10b981';

            if (sponge >= 100 && !cooldownActive) {
                triggerStrike();
            }
        }

        function triggerStrike() {
            tallyCount++;
            tallyDisplay.innerText = tallyCount;
            cooldownActive = true;
            spongeFill.style.backgroundColor = '#ef4444';
            frame.classList.add('cooldown-active', 'bg-red-950');
            cooldownStatus.innerText = "COOLDOWN ACTIVE";
            cooldownStatus.classList.add('text-red-500');
            
            // SHOW SHUSH POPUP
            shushOverlay.classList.add('active');
            
            if (navigator.vibrate) navigator.vibrate(500);

            setTimeout(() => {
                // HIDE SHUSH & RESET
                shushOverlay.classList.remove('active');
                cooldownActive = false;
                sponge = 0;
                frame.classList.remove('cooldown-active', 'bg-red-950');
                cooldownStatus.innerText = "ACOUSTIC MONITOR";
                cooldownStatus.classList.remove('text-red-500');
            }, 2500); 
        }

        snapBtn.onclick = () => { 
            if(analyser) {
                let snapVal = Math.round(currentVolPct);
                snapVal = Math.max(5, Math.min(95, snapVal));
                thresholdIn.value = snapVal;
                document.getElementById('threshold-val').innerText = snapVal;
                thresholdLine.style.top = (100 - snapVal) + '%';
            }
        };

        startBtn.onclick = init;
        
        document.getElementById('resetBtn').onclick = () => { 
            tallyCount = 0; 
            sponge = 0; 
            tallyDisplay.innerText = '0';
            spongeFill.style.height = '0%';
            cooldownActive = false;
            frame.classList.remove('cooldown-active', 'bg-red-950');
            shushOverlay.classList.remove('active');
        };
    </script>
</body>
</html>
